from typing import Generator
from redis import ConnectionPool

import pytest
from fastapi.testclient import TestClient

from app.core.db import SessionLocal
from app.__main__ import app

# import os
# os.environ["ENV"] = "test"


# Фикстура для создания тестовой базы данных
@pytest.fixture(scope="session")
def db() -> Generator:
    yield SessionLocal()


# Фикстура для создания тестового клиента
@pytest.fixture(scope="module")
def client() -> Generator:
    with TestClient(app) as client:
        yield client


@pytest.fixture(scope="session")
def redis() -> Generator:
    yield ConnectionPool()
